!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.flv2canvas=e()}}(function(){var e;return function(){function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[o]={exports:{}};t[o][0].call(h.exports,function(e){return i(t[o][1][e]||e)},h,h.exports,e,t,r,n)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}return e}()({1:[function(t,r,n){(function(i,a){!function(t,i){"object"==typeof n&&void 0!==r?r.exports=i():"function"==typeof e&&e.amd?e(i):t.ES6Promise=i()}(this,function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function r(e){return"function"==typeof e}function n(e){G=e}function o(e){V=e}function s(){return void 0!==M?function(){M(l)}:u()}function u(){var e=setTimeout;return function(){return e(l,1)}}function l(){for(var e=0;e<I;e+=2){(0,H[e])(H[e+1]),H[e]=void 0,H[e+1]=void 0}I=0}function h(e,t){var r=this,n=new this.constructor(c);void 0===n[q]&&R(n);var i=r._state;if(i){var a=arguments[i-1];V(function(){return T(i,n,a,r._result)})}else E(r,n,e,t);return n}function f(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(c);return m(r,e),r}function c(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function _(){return new TypeError("A promises callback cannot return that same promise.")}function v(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function p(e,t,r){V(function(e){var n=!1,i=v(r,t,function(r){n||(n=!0,t!==r?m(e,r):w(e,r))},function(t){n||(n=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&i&&(n=!0,A(e,i))},e)}function y(e,t){t._state===J?w(e,t._result):t._state===Q?A(e,t._result):E(t,void 0,function(t){return m(e,t)},function(t){return A(e,t)})}function g(e,t,n){t.constructor===e.constructor&&n===h&&t.constructor.resolve===f?y(e,t):void 0===n?w(e,t):r(n)?p(e,t,n):w(e,t)}function m(t,r){if(t===r)A(t,d());else if(e(r)){var n=void 0;try{n=r.then}catch(e){return void A(t,e)}g(t,r,n)}else w(t,r)}function b(e){e._onerror&&e._onerror(e._result),L(e)}function w(e,t){e._state===Z&&(e._result=t,e._state=J,0!==e._subscribers.length&&V(L,e))}function A(e,t){e._state===Z&&(e._state=Q,e._result=t,V(b,e))}function E(e,t,r,n){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+J]=r,i[a+Q]=n,0===a&&e._state&&V(L,e)}function L(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,a=e._result,o=0;o<t.length;o+=3)n=t[o],i=t[o+r],n?T(r,n,i,a):i(a);e._subscribers.length=0}}function T(e,t,n,i){var a=r(n),o=void 0,s=void 0,u=!0;if(a){try{o=n(i)}catch(e){u=!1,s=e}if(t===o)return void A(t,_())}else o=i;t._state!==Z||(a&&u?m(t,o):!1===u?A(t,s):e===J?w(t,o):e===Q&&A(t,o))}function k(e,t){try{t(function(t){m(e,t)},function(t){A(e,t)})}catch(t){A(e,t)}}function x(){return $++}function R(e){e[q]=$++,e._state=void 0,e._result=void 0,e._subscribers=[]}function C(){return new Error("Array Methods must be provided an Array")}function S(e){return new ee(this,e).promise}function D(e){var t=this;return new t(F(e)?function(r,n){for(var i=e.length,a=0;a<i;a++)t.resolve(e[a]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function B(e){var t=this,r=new t(c);return A(r,e),r}function O(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function P(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function U(){var e=void 0;if(void 0!==a)e=a;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=te}var j=void 0;j=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var F=j,I=0,M=void 0,G=void 0,V=function(e,t){H[I]=e,H[I+1]=t,2===(I+=2)&&(G?G(l):W())},N="undefined"!=typeof window?window:void 0,z=N||{},X=z.MutationObserver||z.WebKitMutationObserver,K="undefined"==typeof self&&void 0!==i&&"[object process]"==={}.toString.call(i),Y="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,H=new Array(1e3),W=void 0;W=K?function(){return function(){return i.nextTick(l)}}():X?function(){var e=0,t=new X(l),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():Y?function(){var e=new MessageChannel;return e.port1.onmessage=l,function(){return e.port2.postMessage(0)}}():void 0===N&&"function"==typeof t?function(){try{var e=Function("return this")().require("vertx");return M=e.runOnLoop||e.runOnContext,s()}catch(e){return u()}}():u();var q=Math.random().toString(36).substring(2),Z=void 0,J=1,Q=2,$=0,ee=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[q]||R(this.promise),F(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&w(this.promise,this._result))):A(this.promise,C())}return e.prototype._enumerate=function(e){for(var t=0;this._state===Z&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===f){var i=void 0,a=void 0,o=!1;try{i=e.then}catch(e){o=!0,a=e}if(i===h&&e._state!==Z)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===te){var s=new r(c);o?A(s,a):g(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===Z&&(this._remaining--,e===Q?A(n,r):this._result[t]=r),0===this._remaining&&w(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;E(e,void 0,function(e){return r._settledAt(J,t,e)},function(e){return r._settledAt(Q,t,e)})},e}(),te=function(){function e(t){this[q]=x(),this._result=this._state=void 0,this._subscribers=[],c!==t&&("function"!=typeof t&&O(),this instanceof e?k(this,t):P())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,n=t.constructor;return r(e)?t.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):t.then(e,e)},e}();return te.prototype.then=h,te.all=S,te.race=D,te.resolve=f,te.reject=B,te._setScheduler=n,te._setAsap=o,te._asap=V,te.polyfill=U,te.Promise=te,te})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,t,r){function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=w(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function i(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function a(e,t,r){if(t)e.call(r);else for(var n=e.length,i=p(e,n),a=0;a<n;++a)i[a].call(r)}function o(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,a=p(e,i),o=0;o<i;++o)a[o].call(r,n)}function s(e,t,r,n,i){if(t)e.call(r,n,i);else for(var a=e.length,o=p(e,a),s=0;s<a;++s)o[s].call(r,n,i)}function u(e,t,r,n,i,a){if(t)e.call(r,n,i,a);else for(var o=e.length,s=p(e,o),u=0;u<o;++u)s[u].call(r,n,i,a)}function l(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,a=p(e,i),o=0;o<i;++o)a[o].apply(r,n)}function h(e,t,r,n){var a,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if(o=e._events,o?(o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]):(o=e._events=w(null),e._eventsCount=0),s){if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(a=i(e))&&a>0&&s.length>a){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",u.name,u.message)}}else s=o[t]=r,++e._eventsCount;return e}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function c(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=E.call(f,n);return i.listener=r,n.wrapFn=i,i}function d(e,t,r){var n=e._events;if(!n)return[];var i=n[t];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?y(i):p(i,i.length):[]}function _(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function v(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}function p(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function g(e){var t=function(){};return t.prototype=e,new t}function m(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r}function b(e){var t=this;return function(){return t.apply(e,arguments)}}var w=Object.create||g,A=Object.keys||m,E=Function.prototype.bind||b;t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0;var L,T=10;try{var k={};Object.defineProperty&&Object.defineProperty(k,"x",{value:0}),L=0===k.x}catch(e){L=!1}L?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return T},set:function(e){if("number"!=typeof e||e<0||e!==e)throw new TypeError('"defaultMaxListeners" must be a positive number');T=e}}):n.defaultMaxListeners=T,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return i(this)},n.prototype.emit=function(e){var t,r,n,i,h,f,c="error"===e;if(f=this._events)c=c&&null==f.error;else if(!c)return!1;if(c){if(arguments.length>1&&(t=arguments[1]),t instanceof Error)throw t;var d=new Error('Unhandled "error" event. ('+t+")");throw d.context=t,d}if(!(r=f[e]))return!1;var _="function"==typeof r;switch(n=arguments.length){case 1:a(r,_,this);break;case 2:o(r,_,this,arguments[1]);break;case 3:s(r,_,this,arguments[1],arguments[2]);break;case 4:u(r,_,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),h=1;h<n;h++)i[h-1]=arguments[h];l(r,_,this,i)}return!0},n.prototype.addListener=function(e,t){return h(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return h(this,e,t,!0)},n.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,c(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,c(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,n,i,a,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=w(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){o=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():v(r,i),1===r.length&&(n[e]=r[0]),n.removeListener&&this.emit("removeListener",e,o||t)}return this},n.prototype.removeAllListeners=function(e){var t,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=w(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=w(null):delete r[e]),this;if(0===arguments.length){var i,a=A(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=w(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},n.prototype.listeners=function(e){return d(this,e,!0)},n.prototype.rawListeners=function(e){return d(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},n.prototype.listenerCount=_,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],3:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(e){if(f===setTimeout)return setTimeout(e,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function o(e){if(c===clearTimeout)return clearTimeout(e);if((c===i||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function s(){p&&_&&(p=!1,_.length?v=_.concat(v):y=-1,v.length&&u())}function u(){if(!p){var e=a(s);p=!0;for(var t=v.length;t;){for(_=v,v=[];++y<t;)_&&_[y].run();y=-1,t=v.length}_=null,p=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function h(){}var f,c,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(e){f=n}try{c="function"==typeof clearTimeout?clearTimeout:i}catch(e){c=i}}();var _,v=[],p=!1,y=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];v.push(new l(e,t)),1!==v.length||p||a(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return i(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}}},{key:"_search",value:function(e,t){var r=0,n=e.length-1,i=0,a=0,o=n;for(t<e[0]&&(r=0,a=o+1);a<=o;){if((i=a+Math.floor((o-a)/2))===n||t>=e[i]&&t<e[i+1]){r=i;break}e[i]<t?a=i+1:o=i-1}return r}}]),e}();r.default=a},{}],5:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("../utils/logger.js"),s=n(o),u=e("../utils/utf8-conv.js"),l=n(u),h=e("../utils/exception.js"),f=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),c=function(){function e(){i(this,e)}return a(e,null,[{key:"parseScriptData",value:function(t,r,n){var i={};try{var a=e.parseValue(t,r,n),o=e.parseValue(t,r+a.size,n-a.size);i[a.data]=o.data}catch(e){s.default.e("AMF",e.toString())}return i}},{key:"parseObject",value:function(t,r,n){if(n<3)throw new h.IllegalStateException("Data not enough when parse ScriptDataObject");var i=e.parseString(t,r,n),a=e.parseValue(t,r+i.size,n-i.size),o=a.objectEnd;return{data:{name:i.data,value:a.data},size:i.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,r,n){return e.parseObject(t,r,n)}},{key:"parseString",value:function(e,t,r){if(r<2)throw new h.IllegalStateException("Data not enough when parse String");var n=new DataView(e,t,r),i=n.getUint16(0,!f),a=void 0;return a=i>0?(0,l.default)(new Uint8Array(e,t+2,i)):"",{data:a,size:2+i}}},{key:"parseLongString",value:function(e,t,r){if(r<4)throw new h.IllegalStateException("Data not enough when parse LongString");var n=new DataView(e,t,r),i=n.getUint32(0,!f),a=void 0;return a=i>0?(0,l.default)(new Uint8Array(e,t+4,i)):"",{data:a,size:4+i}}},{key:"parseDate",value:function(e,t,r){if(r<10)throw new h.IllegalStateException("Data size invalid when parse Date");var n=new DataView(e,t,r),i=n.getFloat64(0,!f);return i+=60*n.getInt16(8,!f)*1e3,{data:new Date(i),size:10}}},{key:"parseValue",value:function(t,r,n){if(n<1)throw new h.IllegalStateException("Data not enough when parse Value");var i=new DataView(t,r,n),a=1,o=i.getUint8(0),u=void 0,l=!1;try{switch(o){case 0:u=i.getFloat64(1,!f),a+=8;break;case 1:u=!!i.getUint8(1),a+=1;break;case 2:var c=e.parseString(t,r+1,n-1);u=c.data,a+=c.size;break;case 3:u={};var d=0;for(9==(16777215&i.getUint32(n-4,!f))&&(d=3);a<n-4;){var _=e.parseObject(t,r+a,n-a-d);if(_.objectEnd)break;u[_.data.name]=_.data.value,a+=_.size}if(a<=n-3){9===(16777215&i.getUint32(a-1,!f))&&(a+=3)}break;case 8:u={},a+=4;var v=0;for(9==(16777215&i.getUint32(n-4,!f))&&(v=3);a<n-8;){var p=e.parseVariable(t,r+a,n-a-v);if(p.objectEnd)break;u[p.data.name]=p.data.value,a+=p.size}if(a<=n-3){9===(16777215&i.getUint32(a-1,!f))&&(a+=3)}break;case 9:u=void 0,a=1,l=!0;break;case 10:u=[];var y=i.getUint32(1,!f);a+=4;for(var g=0;g<y;g++){var m=e.parseValue(t,r+a,n-a);u.push(m.data),a+=m.size}break;case 11:var b=e.parseDate(t,r+1,n-1);u=b.data,a+=b.size;break;case 12:var w=e.parseString(t,r+1,n-1);u=w.data,a+=w.size;break;default:a=n,s.default.w("AMF","Unsupported AMF value type "+o)}}catch(e){s.default.e("AMF",e.toString())}return{data:u,size:a,objectEnd:l}}}]),e}();r.default=c},{"../utils/exception.js":20,"../utils/logger.js":21,"../utils/utf8-conv.js":23}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};r.default=n},{}],7:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("../utils/exception.js"),o=function(){function e(t){n(this,e),this.TAG="ExpGolomb",this._buffer=t,this._buffer_index=0,this._total_bytes=t.byteLength,this._total_bits=8*t.byteLength,this._current_word=0,this._current_word_bits_left=0}return i(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new a.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new a.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var n=e-this._current_word_bits_left;this._fillCurrentWord();var i=Math.min(n,this._current_word_bits_left),o=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,r=r<<i|o}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();r.default=o},{"../utils/exception.js":20}],8:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=e("../utils/logger.js"),h=n(l),f=e("./amf-parser.js"),c=n(f),d=e("./sps-parser.js"),_=n(d),v=e("./demux-errors.js"),p=n(v),y=e("../core/media-info.js"),g=n(y),m=(e("../utils/exception.js"),function(){function e(t,r){a(this,e),this.TAG="FLVDemuxer",this._config=r,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new g.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return u(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this.onAudioParseDone=null,this.onVideoParseDone=null}},{key:"bindDataSource",value:function(e){return this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new g.default}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,r){window.demuxer1=window.performance.now();var n=0,i=this._littleEndian;if(0===r){if(!(t.byteLength>13))return 0;n=e.probe(t).dataOffset}if(this._firstParse){this._firstParse=!1,r+n!==this._dataOffset&&h.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");0!==new DataView(t,n).getUint32(0,!i)&&h.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4}for(;n<t.byteLength;){this._dispatch=!0;var a=new DataView(t,n);if(n+11+4>t.byteLength)break;var o=a.getUint8(0),s=16777215&a.getUint32(0,!i);if(n+11+s+4>t.byteLength)break;if(8===o||9===o||18===o){var u=a.getUint8(4),l=a.getUint8(5),f=a.getUint8(6),c=a.getUint8(7),d=f|l<<8|u<<16|c<<24;0!==(16777215&a.getUint32(7,!i))&&h.default.w(this.TAG,"Meet tag which has StreamID != 0!");var _=n+11;switch(o){case 8:break;case 9:this._parseVideoData(t,_,s,d,r+n);break;case 18:this._parseScriptData(t,_,s)}var v=a.getUint32(11+s,!i);v!==11+s&&h.default.w(this.TAG,"Invalid PrevTagSize "+v),n+=11+s+4}else h.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),n+=11+s+4}return n}},{key:"_parseScriptData",value:function(e,t,r){var n=c.default.parseScriptData(e,t,r);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!==s(n.onMetaData))return void h.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&h.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=n;var i=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},i)),"boolean"==typeof i.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=i.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof i.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=i.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof i.audiodatarate&&(this._mediaInfo.audioDataRate=i.audiodatarate),"number"==typeof i.videodatarate&&(this._mediaInfo.videoDataRate=i.videodatarate),"number"==typeof i.width&&(this._mediaInfo.width=i.width),"number"==typeof i.height&&(this._mediaInfo.height=i.height),"number"==typeof i.duration){if(!this._durationOverrided){var a=Math.floor(i.duration*this._timescale);this._duration=a,this._mediaInfo.duration=a}}else this._mediaInfo.duration=0;if("number"==typeof i.framerate){var o=Math.floor(1e3*i.framerate);if(o>0){var u=o/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=u,this._referenceFrameRate.fps_num=o,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=u}}if("object"===s(i.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var l=i.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(l),i.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=i,h.default.v(this.TAG,"Parsed onMetaData")}Object.keys(n).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},n))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],r=[],n=1;n<e.times.length;n++){var i=this._timestampBase+Math.floor(1e3*e.times[n]);t.push(i),r.push(e.filepositions[n])}return{times:t,filepositions:r}}},{key:"_parseAudioData",value:function(e,t,r,n){if(r<=1)return void h.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){var a=(this._littleEndian,new DataView(e,t,r)),o=a.getUint8(0),s=o>>>4;if(2!==s&&10!==s)return void this._onError(p.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s);var u=0,l=(12&o)>>>2;if(!(l>=0&&l<=4))return void this._onError(p.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);u=this._flvSoundRateTable[l];var f=1&o,c=this._audioMetadata,d=this._audioTrack;if(c||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),c=this._audioMetadata={},c.type="audio",c.id=d.id,c.timescale=this._timescale,c.duration=this._duration,c.audioSampleRate=u,c.channelCount=0===f?1:2),10===s){var _=this._parseAACAudioData(e,t+1,r-1);if(void 0==_)return;if(0===_.packetType){c.config&&h.default.w(this.TAG,"Found another AudioSpecificConfig!");var v=_.data;c.audioSampleRate=v.samplingRate,c.channelCount=v.channelCount,c.codec=v.codec,c.originalCodec=v.originalCodec,c.config=v.config,c.refSampleDuration=1024/c.audioSampleRate*c.timescale,h.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this.HEADER={audioObjectType:c.audioObjectType,samplingFrequencyIndex:c.samplingFrequencyIndex,channelConfig:c.channelConfig};var y=this._mediaInfo;y.audioCodec=c.originalCodec,y.audioSampleRate=c.audioSampleRate,y.audioChannelCount=c.channelCount,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()}else if(1===_.packetType){var g=this._timestampBase+n,m={unit:_.data,length:_.data.byteLength,dts:g,pts:g},b=this,w=function(e){var t=e.audioObjectType,r=e.samplingFrequencyIndex,n=e.channelConfig,i=e.adtsLen,a=new Uint8Array(7);return a[0]=255,a[1]=240,a[1]|=0,a[1]|=0,a[1]|=1,a[2]=t-1<<6,a[2]|=(15&r)<<2,a[2]|=0,a[2]|=(4&n)>>2,a[3]=(3&n)<<6,a[3]|=0,a[3]|=0,a[3]|=0,a[3]|=0,a[3]|=(6144&i)>>11,a[4]=(2040&i)>>3,
a[5]=(7&i)<<5,a[5]|=31,a[6]=252,a}({audioObjectType:b.HEADER.audioObjectType,samplingFrequencyIndex:b.HEADER.samplingFrequencyIndex,channelConfig:b.HEADER.channelConfig,adtsLen:m.length+7}),A=[];A.push.apply(A,i(w).concat(i(m.unit))),this.onAudioParseDone(A)}else h.default.e(this.TAG,"Flv: Unsupported AAC data type "+_.packetType)}else if(2===s){if(!c.codec){var E=this._parseMP3AudioData(e,t+1,r-1,!0);if(void 0==E)return;c.audioSampleRate=E.samplingRate,c.channelCount=E.channelCount,c.codec=E.codec,c.originalCodec=E.originalCodec,c.refSampleDuration=1152/c.audioSampleRate*c.timescale,h.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0;var L=this._mediaInfo;L.audioCodec=c.codec,L.audioSampleRate=c.audioSampleRate,L.audioChannelCount=c.channelCount,L.audioDataRate=E.bitRate,L.hasVideo?null!=L.videoCodec&&(L.mimeType='video/x-flv; codecs="'+L.videoCodec+","+L.audioCodec+'"'):L.mimeType='video/x-flv; codecs="'+L.audioCodec+'"',L.isComplete()&&this._onMediaInfo(L)}var T=this._parseMP3AudioData(e,t+1,r-1,!1);if(void 0==T)return;var k=this._timestampBase+n,x={unit:T,length:T.byteLength,dts:k,pts:k};d.samples.push(x),d.length+=T.length}}}},{key:"_parseAACAudioData",value:function(e,t,r){if(r<=1)return void h.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var n={},i=new Uint8Array(e,t,r);return n.packetType=i[0],0===i[0]?n.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):n.data=i.subarray(1),n}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,r){var n=new Uint8Array(e,t,r),i=null,a=0,o=0,s=0,u=null;if(a=o=n[0]>>>3,(s=(7&n[0])<<1|n[1]>>>7)<0||s>=this._mpegSamplingRates.length)return void this._onError(p.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var l=this._mpegSamplingRates[s],h=(120&n[1])>>>3;if(h<0||h>=8)return void this._onError(p.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(u=(7&n[1])<<1|n[2]>>>7,n[2]);var f=self.navigator.userAgent.toLowerCase();return-1!==f.indexOf("firefox")?s>=6?(a=5,i=new Array(4),u=s-3):(a=2,i=new Array(2),u=s):-1!==f.indexOf("android")?(a=2,i=new Array(2),u=s):(a=5,u=s,i=new Array(4),s>=6?u=s-3:1===h&&(a=2,i=new Array(2),u=s)),i[0]=a<<3,i[0]|=(15&s)>>>1,i[1]=(15&s)<<7,i[1]|=(15&h)<<3,5===a&&(i[1]|=(15&u)>>>1,i[2]=(1&u)<<7,i[2]|=8,i[3]=0),{config:i,samplingRate:l,channelCount:h,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function(e,t,r,n){if(r<4)return void h.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var i=(this._littleEndian,new Uint8Array(e,t,r)),a=null;if(n){if(255!==i[0])return;var o=i[1]>>>3&3,s=(6&i[1])>>1,u=(240&i[2])>>>4,l=(12&i[2])>>>2,f=i[3]>>>6&3,c=3!==f?2:1,d=0,_=0;switch(o){case 0:d=this._mpegAudioV25SampleRateTable[l];break;case 2:d=this._mpegAudioV20SampleRateTable[l];break;case 3:d=this._mpegAudioV10SampleRateTable[l]}switch(s){case 1:34,u<this._mpegAudioL3BitRateTable.length&&(_=this._mpegAudioL3BitRateTable[u]);break;case 2:33,u<this._mpegAudioL2BitRateTable.length&&(_=this._mpegAudioL2BitRateTable[u]);break;case 3:32,u<this._mpegAudioL1BitRateTable.length&&(_=this._mpegAudioL1BitRateTable[u])}a={bitRate:_,samplingRate:d,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else a=i;return a}},{key:"_parseVideoData",value:function(e,t,r,n,i){if(r<=1)return void h.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var a=new Uint8Array(e,t,r)[0],o=(240&a)>>>4,s=15&a;if(7!==s)return void this._onError(p.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+s);this._parseAVCVideoPacket(e,t+1,r-1,n,i,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,r,n,i,a){if(r<4)return void h.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var o=this._littleEndian,s=new DataView(e,t,r),u=s.getUint8(0),l=16777215&s.getUint32(0,!o),f=l<<8>>8;if(0===u)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===u)this._parseAVCVideoData(e,t+4,r-4,n,i,a,f);else if(2!==u)return void this._onError(p.default.FORMAT_ERROR,"Flv: Invalid video packet type "+u)}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,r){if(r<7)return void h.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var n=this._videoMetadata,i=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,r);n?void 0!==n.avcc&&h.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),n=this._videoMetadata={},n.type="video",n.id=i.id,n.timescale=this._timescale,n.duration=this._duration);var s=o.getUint8(0),u=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1!==s||0===u)return void this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=1+(3&o.getUint8(4)),3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(p.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var l=31&o.getUint8(5);if(0===l)return void this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");l>1&&h.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+l);for(var f=6,c=0;c<l;c++){var d=o.getUint16(f,!a);if(f+=2,0!==d){var v=new Uint8Array(e,t+f,d);f+=d;var y=new Uint8Array(d);y.set(v,0);var g=_.default.parseSPS(v);if(0===c){this.onVideoParseDone(y),n.codecWidth=g.codec_size.width,n.codecHeight=g.codec_size.height,n.presentWidth=g.present_size.width,n.presentHeight=g.present_size.height,n.profile=g.profile_string,n.level=g.level_string,n.bitDepth=g.bit_depth,n.chromaFormat=g.chroma_format,n.sarRatio=g.sar_ratio,n.frameRate=g.frame_rate,!1!==g.frame_rate.fixed&&0!==g.frame_rate.fps_num&&0!==g.frame_rate.fps_den||(n.frameRate=this._referenceFrameRate);var m=n.frameRate.fps_den,b=n.frameRate.fps_num;n.refSampleDuration=n.timescale*(m/b);for(var w=v.subarray(1,4),A="avc1.",E=0;E<3;E++){var L=w[E].toString(16);L.length<2&&(L="0"+L),A+=L}n.codec=A;var T=this._mediaInfo;T.width=n.codecWidth,T.height=n.codecHeight,T.fps=n.frameRate.fps,T.profile=n.profile,T.level=n.level,T.refFrames=g.ref_frames,T.chromaFormat=g.chroma_format_string,T.sarNum=n.sarRatio.width,T.sarDen=n.sarRatio.height,T.videoCodec=A,T.hasAudio?null!=T.audioCodec&&(T.mimeType='video/x-flv; codecs="'+T.videoCodec+","+T.audioCodec+'"'):T.mimeType='video/x-flv; codecs="'+T.videoCodec+'"'}}}var k=o.getUint8(f);if(0===k)return void this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");k>1&&h.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+k),f++;for(var x=0;x<k;x++){var R=o.getUint16(f,!a);if(f+=2,0!==R){var C=new Uint8Array(e,t+f,R),S=new Uint8Array(R);S.set(C,0),this.onVideoParseDone(S),f+=R}}n.avcc=new Uint8Array(r),n.avcc.set(new Uint8Array(e,t,r),0),h.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1}},{key:"_parseAVCVideoData",value:function(e,t,r,n,i,a,o){for(var s=this._littleEndian,u=new DataView(e,t,r),l=[],f=0,c=0,d=this._naluLengthSize,_=this._timestampBase+n,v=1===a;c<r;){if(c+4>=r){h.default.w(this.TAG,"Malformed Nalu near timestamp "+_+", offset = "+c+", dataSize = "+r);break}var p=u.getUint32(c,!s);if(3===d&&(p>>>=8),p>r-d)return void h.default.w(this.TAG,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var y=31&u.getUint8(c+d);5===y&&(v=!0);var g=new Uint8Array(e,t+c,d+p),m=g.slice(4,e.length);this.onVideoParseDone(m);var b={type:y,data:g};l.push(b),f+=g.byteLength,c+=d+p}if(l.length){var w=(this._videoTrack,{units:l,length:f,isKeyframe:v,dts:_,cts:o,pts:_+o});v&&(w.fileposition=i),w.dts,this.saveDts(w.dts)}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var n=(4&t[4])>>>2!=0,i=0!=(1&t[4]),a=o(t,5);return a<9?r:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:n,hasVideoTrack:i}}}]),e}());r.default=m},{"../core/media-info.js":4,"../utils/exception.js":20,"../utils/logger.js":21,"./amf-parser.js":5,"./demux-errors.js":6,"./sps-parser.js":9}],9:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./exp-golomb.js"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return i(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,r=t.byteLength,n=new Uint8Array(r),i=0,a=0;a<r;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(n[i]=t[a],i++);return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(t){var r=e._ebsp2rbsp(t),n=new o.default(r);n.readByte();var i=n.readByte();n.readByte();var a=n.readByte();n.readUEG();var s=e.getProfileString(i),u=e.getLevelString(a),l=1,h=420,f=[0,420,422,444],c=8;if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||144===i)&&(l=n.readUEG(),3===l&&n.readBits(1),l<=3&&(h=f[l]),c=n.readUEG()+8,n.readUEG(),n.readBits(1),n.readBool()))for(var d=3!==l?8:12,_=0;_<d;_++)n.readBool()&&(_<6?e._skipScalingList(n,16):e._skipScalingList(n,64));n.readUEG();var v=n.readUEG();if(0===v)n.readUEG();else if(1===v){n.readBits(1),n.readSEG(),n.readSEG();for(var p=n.readUEG(),y=0;y<p;y++)n.readSEG()}var g=n.readUEG();n.readBits(1);var m=n.readUEG(),b=n.readUEG(),w=n.readBits(1);0===w&&n.readBits(1),n.readBits(1);var A=0,E=0,L=0,T=0;n.readBool()&&(A=n.readUEG(),E=n.readUEG(),L=n.readUEG(),T=n.readUEG());var k=1,x=1,R=0,C=!0,S=0,D=0;if(n.readBool()){if(n.readBool()){var B=n.readByte(),O=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],P=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];B>0&&B<16?(k=O[B-1],x=P[B-1]):255===B&&(k=n.readByte()<<8|n.readByte(),x=n.readByte()<<8|n.readByte())}if(n.readBool()&&n.readBool(),n.readBool()&&(n.readBits(4),n.readBool()&&n.readBits(24)),n.readBool()&&(n.readUEG(),n.readUEG()),n.readBool()){var U=n.readBits(32),j=n.readBits(32);C=n.readBool(),S=j,D=2*U,R=S/D}}var F=1;1===k&&1===x||(F=k/x);var I=0,M=0;if(0===l)I=1,M=2-w;else{var G=3===l?1:2,V=1===l?2:1;I=G,M=V*(2-w)}var N=16*(m+1),z=16*(b+1)*(2-w);N-=(A+E)*I,z-=(L+T)*M;var X=Math.ceil(N*F);return n.destroy(),n=null,{profile_string:s,level_string:u,bit_depth:c,ref_frames:g,chroma_format:h,chroma_format_string:e.getChromaFormatString(h),frame_rate:{fixed:C,fps:R,fps_den:D,fps_num:S},sar_ratio:{width:k,height:x},codec_size:{width:N,height:z},present_size:{width:X,height:z}}}},{key:"_skipScalingList",value:function(e,t){for(var r=8,n=8,i=0,a=0;a<t;a++)0!==n&&(i=e.readSEG(),n=(r+i+256)%256),r=0===n?r:n}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();r.default=s},{"./exp-golomb.js":7}],10:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./flv2canvas.loader"),s=n(o),u=e("./render/yuv-canvas"),l=n(u),h=function(){function e(t){i(this,e),this.playWidth=0,this.playHeight=0,this.videoBuffer=[],this.videoDts=[],this.startPlay=!1,this.hasFixPosition=!1,this.options=t,this.canvasObj={},this.loadCtl=new s.default(t),this.loadCtl.saveDts=this._saveDts.bind(this),this.loader=this.loadCtl.createLoader(),this.initRender(),this.initWorker()}return a(e,[{key:"load",value:function(){this.loader.load()}},{key:"play",value:function(){this.startPlay=!0}},{key:"stop",value:function(){this.startPlay=!1}},{key:"destory",value:function(){console.log("关闭播放器");var e=this;this.avc=null,this.videoDts=[],this.videoBuffer=[],this.loadCtl.destroy(),this.worker&&this.worker.terminate(),window.cancelAnimationFrame(e.interval)}},{key:"initWorker",value:function(){console.log(),this.worker=new Worker(this.options.workFile),this.loadCtl.worker=this.worker,this.worker.postMessage({type:"Broadway.js - Worker init",options:{rgb:!1,memsize:"",reuseMemory:!0}});var e=this;this.worker.addEventListener("error",function(e){}),this.worker.addEventListener("message",function(t){var r=t.data;if(r.consoleLog)return console.log(r.consoleLog),void e.load();var n=t.data.buf,i=t.data.width,a=t.data.height;e.onPictureDecoded(n,i,a,r.infos)},!1)}},{key:"initRender",value:function(){function e(){if(t.interval=requestAnimationFrame(e),t.startPlay){if(i>400&&(console.log("重启"),t.restart()),i>50&&!u&&(u=!0,t.showLoading(!0)),0===t.videoBuffer.length&&t.hasFixPosition)return console.log("没有数据noData",i),void i++;u&&(t.showLoading(!1),u=!1),i=0;var l=Date.now();if(n+=l-r,r=Date.now(),t.videoBuffer.length<15)return void(++o>=5&&t.videoBuffer[0]&&(t.renderFrame({canvasObj:t.canvasObj,data:t.videoBuffer[0],width:t.playWidth,height:t.playHeight}),t.videoBuffer.shift(),o=0));if(t.videoBuffer.length>40&&s++,s>4&&t.videoBuffer[0])return t.renderFrame({canvasObj:t.canvasObj,data:t.videoBuffer[0],width:t.playWidth,height:t.playHeight}),t.videoBuffer.shift(),void(s=0);n<a||(n%=a,t.videoBuffer[0]?(t.renderFrame({canvasObj:t.canvasObj,data:t.videoBuffer[0],width:t.playWidth,height:t.playHeight}),t.videoBuffer.shift(),t.hasFixPosition||(t.fixPosition(),t.showLoading(!1),console.log("Start to play,and fix position"),t.hasFixPosition=!0)):console.log("no data"))}}var t=this;this.renderFrame=this.renderFrameWebGL,this.createCanvasObj=this.createCanvasWebGL,this.canvasObj=this.createCanvasObj(),this.canvasObj.canvas=this.options.canvasDom;var r=Date.now(),n=0,i=0,a=50,o=0,s=0,u=!1;e()}},{key:"_saveDts",value:function(e){var t=this.videoDts;if(0===t.length)this.videoDts.push(e);else if(1===t.length)e>t[0]?this.videoDts.push(e):this.videoDts.unshift(e);else{for(var r=!1,n=0;n<this.videoDts.length;n++)if(e<this.videoDts[n]||e===this.videoDts[n]){var i=t.slice(0,n),a=t.slice(n,t.length);i.push(e),this.videoDts=i.concat(a),r=!0;break}r||this.videoDts.push(e)}}},{key:"onPictureDecoded",value:function(e,t,r,n){if(window.decode2=window.performance.now(),!document.hidden){this.playWidth=t,this.playHeight=r,this.videoBuffer.push(new Uint8Array(e));var i=this;if(this.videoBuffer.length>50&&!this.startPlay){console.log("clear",this.videoBuffer.length,this.videoDts.length),this.videoBuffer=[],i.videoDts=[];for(var a=0;a<50;)i.videoDts.shift(),a++}}}},{key:"renderFrameWebGL",value:function(e){var t=e.canvasObj,r=e.width||t.canvas.width,n=e.height||t.canvas.height;t.canvas.width===r&&t.canvas.height===n&&t.webGLCanvas||(t.canvas.width=r,t.canvas.height=n,t.webGLCanvas=new l.default({canvas:t.canvas,contextOptions:t.contextOptions,width:r,height:n}));var i=r*n,a=r/2*(n/2);t.webGLCanvas.drawNextOutputPicture({yData:e.data.subarray(0,i),uData:e.data.subarray(i,i+a),vData:e.data.subarray(i+a,i+a+a)}),this.recycleMemory(e.data)}},{key:"recycleMemory",value:function(e){}},{key:"createCanvasWebGL",value:function(e){return this._createBasicCanvasObj(e)}},{key:"_createBasicCanvasObj",value:function(e){e=e||{};var t={};return t.canvas=document.createElement("canvas"),t.canvas.style.backgroundColor="#0D0E1B",t}},{key:"fixPosition",value:function(){}},{key:"showLoading",value:function(){}}]),e}();r.default=h},{"./flv2canvas.loader":11,"./render/yuv-canvas":18}],11:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./utils/polyfill.js"),s=n(o),u=e("./loader/io-controller"),l=n(u);s.default.install();var h=function(){function e(t){i(this,e),this._config=t}return a(e,[{key:"createLoader",value:function(){return this.ioctl=new l.default(this._config),this.ioctl.onVideoParseDone=this._onVideoParseDone.bind(this),this.ioctl.onAudioParseDone=this._onAudioParseDone.bind(this),this.ioctl.saveDts=this._saveDts.bind(this),this.ioctl}},{key:"_onVideoParseDone",value:function(e){var t=new Uint8Array(e.length);t.set(e,0,e.length),window.demuxer2=window.performance.now(),window.decode1=window.performance.now(),this.worker.postMessage({buffer:t,offset:0,length:e.length},[t.buffer])}},{key:"_saveDts",value:function(e){this.saveDts(e)}},{key:"_onAudioParseDone",value:function(e){}},{key:"destroy",value:function(){this.ioctl.destroy()}}]),e}();r.default=h},{"./loader/io-controller":14,"./utils/polyfill.js":22}],12:[function(e,t,r){"use strict";t.exports=e("./flv2canvas.js").default},{"./flv2canvas.js":10}],13:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=e("../utils/browser.js"),h=function(e){return e&&e.__esModule?e:{default:e}}(l),f=e("./loader.js"),c=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));return r.TAG="FetchStreamLoader",r._config=e,r._needStash=!0,r._requestAbort=!1,r._contentLength=null,r._receivedLength=0,r}return a(t,e),u(t,null,[{key:"isSupported",value:function(){try{var e=h.default.msedge&&h.default.version.minor>=15048,t=!h.default.msedge||e;return fetch&&ReadableStream&&t}catch(e){return!1}}}]),u(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(){var e=this,t=new Headers,r={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===o(this._config.headers))for(var n in this._config.headers)t.append(n,this._config.headers[n]);this._status=f.LoaderStatus.kConnecting,fetch(this._config.url,r).then(function(t){if(t.ok&&t.status>=200&&t.status<=299){var r=t.headers.get("Content-Length");return null!=r&&(e._contentLength=parseInt(r),0!==e._contentLength&&e._onContentLengthKnown&&e._onContentLengthKnown(e._contentLength)),e._pump.call(e,t.body.getReader())}e._status=f.LoaderStatus.kError,e._onError&&e._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}).catch(function(t){if(e._status=f.LoaderStatus.kError,!e._onError)throw t;e._onError(f.LoaderErrors.EXCEPTION,{code:-1,msg:t.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(r){if(r.done){if(!0===t._requestAbort)return t._requestAbort=!1,t._status=f.LoaderStatus.kComplete,e.cancel();t._status=f.LoaderStatus.kBuffering;var n=r.value.buffer,i=t._range.from+t._receivedLength;t._receivedLength+=n.byteLength,t._onDataArrival&&t._onDataArrival(n,i,t._receivedLength),t._pump(e)}else{if(!0===t._requestAbort)return t._requestAbort=!1,t._status=f.LoaderStatus.kComplete,e.cancel();t._status=f.LoaderStatus.kBuffering;var a=r.value.buffer,o=t._receivedLength;if(t._receivedLength+=a.byteLength,t._onDataArrival)try{t._onDataArrival(a,o,t._receivedLength)}catch(e){console.log(e)}t._pump(e)}}).catch(function(e){if(11!==e.code||!h.default.msedge){t._status=f.LoaderStatus.kError;var r=0,n=null;19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(r=f.LoaderErrors.EXCEPTION,n={code:e.code,msg:e.message}):(r=f.LoaderErrors.EARLY_EOF,n={code:e.code,msg:"Fetch stream meet Early-EOF"}),t._onError&&t._onError(r,n)}})}}]),t}(f.BaseLoader);r.default=c},{"../utils/browser.js":19,"./loader.js":15}],14:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./fetch-stream-loader.js"),s=n(o),u=e("./xhr-range-loader.js"),l=(n(u),e("events")),h=n(l),f=e("../demux/flv-demuxer.js"),c=n(f),d=e("./speed-sampler.js"),_=n(d),v=function(){function e(t){i(this,e),this._config=t,this._loader=null,this._loaderClass=null,this._seekHandler=null,this._emitter=new h.default,this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new _.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._selectLoader(),this._createLoader()}return a(e,[{key:"_selectLoader",value:function(){s.default.isSupported()&&(this._loaderClass=s.default)}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1)}},{key:"load",value:function(){this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.open()}},{key:"_onInitChunkArrival",value:function(e,t){var r=null,n=0;return t>0?(this._demuxer.bindDataSource(this._loader),n=this._demuxer.parseChunks(e,t)):(r=c.default.probe(e)).match?(this._demuxer=new c.default(r,this._config),this._demuxer.onVideoParseDone=this._onVideoParseDone.bind(this),this._demuxer.onAudioParseDone=this._onAudioParseDone.bind(this),this._demuxer.saveDts=this._saveDts.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),n=this._demuxer.parseChunks(e,t)):r=null,n}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}}},{key:"_onLoaderChunkArrival",value:function(e,t,r){if(this._onDataArrival,!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var n=this._speedSampler.lastSecondKBps;if(0!==n){var i=this._normalizeSpeed(n);this._speedNormalized!==i&&(this._speedNormalized=i,this._adjustStashSize(i))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var o=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),u=this._dispatchChunks(s,this._stashByteStart);if(u<s.byteLength){if(u>0){var l=new Uint8Array(s,u);o.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=u}}else this._stashUsed=0,this._stashByteStart+=u;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var h=this._dispatchChunks(e,t);if(h<e.byteLength){var f=e.byteLength-h;f>this._bufferSize&&(this._expandBuffer(f),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,h),0),this._stashUsed+=f,this._stashByteStart=t+h}}}else if(0===this._stashUsed){var c=this._dispatchChunks(e,t);if(c<e.byteLength){var d=e.byteLength-c;d>this._bufferSize&&this._expandBuffer(d);var _=new Uint8Array(this._stashBuffer,0,this._bufferSize);_.set(new Uint8Array(e,c),0),this._stashUsed+=d,this._stashByteStart=t+c}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var v=new Uint8Array(this._stashBuffer,0,this._bufferSize);v.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var p=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(p<this._stashUsed&&p>0){var y=new Uint8Array(this._stashBuffer,p);v.set(y,0)}this._stashUsed-=p,this._stashByteStart+=p}}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var n=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(n,0)}this._stashBuffer=r,this._bufferSize=t}}},{key:"_dispatchChunks",value:function(e,t){return this._onInitChunkArrival(e,t)}},{key:"_onScriptDataArrived",value:function(e){}},{key:"_onVideoParseDone",value:function(e){this.onVideoParseDone(e)}},{key:"_onAudioParseDone",value:function(e){this.onAudioParseDone(e)}},{key:"_saveDts",value:function(e){this.saveDts(e)}},{key:"destroy",value:function(){console.log("销毁"),this._loader.destroy()}},{key:"onVideoParseDone",value:function(){}},{key:"onAudioParseDone",value:function(){}}]),e}();r.default=v},{"../demux/flv-demuxer.js":8,"./fetch-stream-loader.js":13,"./speed-sampler.js":16,"./xhr-range-loader.js":17,events:2}],15:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};r.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},r.BaseLoader=function(){function e(t){n(this,e),this._type=t||"undefined",this._status=a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return i(e,[{key:"destroy",value:function(){this._status=a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===a.kConnecting||this._status===a.kBuffering}},{key:"open",value:function(e,t){}},{key:"abort",value:function(){}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}()},{}],16:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return i(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,
this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();r.default=a},{}],17:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=e("./speed-sampler.js"),h=function(e){return e&&e.__esModule?e:{default:e}}(l),f=e("./loader.js"),c=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-range-loader"));return a.TAG="RangeLoader",a._seekHandler=r,a._config=e,a._needStash=!1,a._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],a._currentChunkSizeKB=384,a._currentSpeedNormalized=0,a._zeroSpeedChunkCount=0,a._xhr=null,a._speedSampler=new h.default,a._requestAbort=!1,a._waitForTotalLength=!1,a._totalLengthReceived=!1,a._currentRequestURL=null,a._currentRedirectedURL=null,a._currentRequestRange=null,a._totalLength=null,a._contentLength=null,a._receivedLength=0,a._lastTimeLoaded=0,a}return a(t,e),u(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return!1}}}]),u(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var r=this._xhr=new XMLHttpRequest;if(r.open("GET",this._config.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),"object"===o(this._config.headers)){var n=this._config.headers;for(var i in n)n.hasOwnProperty(i)&&r.setRequestHeader(i,n[i])}r.send()}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?r=this._currentRedirectedURL:void 0!=e.redirectedURL&&(r=e.redirectedURL));var n=this._seekHandler.getConfig(r,t);this._currentRequestURL=n.url;var i=this._xhr=new XMLHttpRequest;if(i.open("GET",n.url,!0),i.responseType="arraybuffer",i.onload=this._onLoad.bind(this),i.onerror=this._onXhrError.bind(this),e.withCredentials&&(i.withCredentials=!0),"object"===o(n.headers)){var a=n.headers;for(var s in a)a.hasOwnProperty(s)&&i.setRequestHeader(s,a[s])}if("object"===o(this._config.headers)){var u=this._config.headers;for(var l in u)u.hasOwnProperty(l)&&i.setRequestHeader(l,u[l])}i.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=f.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=f.LoaderStatus.kBuffering}else this._status=f.LoaderStatus.kError,this._onError&&this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},{key:"_onProgress",value:function(e){if(this._status!==f.LoaderStatus.kError){e.target.response}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,r=t.length-1,n=0,i=0,a=r;if(e<t[0])return t[0];for(;i<=a;){if((n=i+Math.floor((a-i)/2))===r||e>=t[n]&&e<t[n+1])return t[n];t[n]<e?i=n+1:a=n-1}}},{key:"_onLoad",value:function(e){if(this._status!==f.LoaderStatus.kError){if(this._waitForTotalLength)return void(this._waitForTotalLength=!1);this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&++this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var n=e.target.response,i=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(n,i,this._receivedLength),a&&(this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=f.LoaderStatus.kError;var t=0,r=null;this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=f.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=f.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),this._onError&&this._onError(t,r)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),t}(f.BaseLoader);r.default=c},{"./loader.js":15,"./speed-sampler.js":16}],18:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),t=t||{},this.canvasElement=t.canvas||document.createElement("canvas"),this.canvasElement.style.top="0",this.canvasElement.style.left="0",this.canvasElement.style.position="relative",this.canvasElement.className="liveCanvas",this.contextOptions=t.contextOptions,this.type=t.type||"yuv420",this.customYUV444=t.customYUV444,this.conversionType=t.conversionType||"rec601",this.width=t.width||640,this.height=t.height||320,this.animationTime=t.animationTime||0,this.canvasElement.width=this.width,this.canvasElement.height=this.height,this.initContextGL(),this.contextGL&&(this.initProgram(),this.initBuffers(),this.initTextures()),"yuv420"===this.type?this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,r=this.texturePosBuffer,n=this.uTexturePosBuffer,i=this.vTexturePosBuffer,a=this.yTextureRef,o=this.uTextureRef,s=this.vTextureRef,u=e.yData,l=e.uData,h=e.vData,f=this.width,c=this.height,d=e.yDataPerRow||f,_=e.yRowCnt||c,v=e.uDataPerRow||f/2,p=e.uRowCnt||c/2,y=e.vDataPerRow||v,g=e.vRowCnt||p;t.viewport(0,0,f,c);var m=c/_,b=f/d,w=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,w,t.DYNAMIC_DRAW),this.customYUV444?(m=c/p,b=f/v):(m=c/2/p,b=f/2/v);var A=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,A,t.DYNAMIC_DRAW),this.customYUV444?(m=c/g,b=f/y):(m=c/2/g,b=f/2/y);var E=new Float32Array([b,0,0,0,b,m,0,m]);t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,E,t.DYNAMIC_DRAW),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,d,_,0,t.LUMINANCE,t.UNSIGNED_BYTE,u),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,v,p,0,t.LUMINANCE,t.UNSIGNED_BYTE,l),t.activeTexture(t.TEXTURE2),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,y,g,0,t.LUMINANCE,t.UNSIGNED_BYTE,h),t.drawArrays(t.TRIANGLE_STRIP,0,4)}:"yuv422"===this.type&&(this.drawNextOuptutPictureGL=function(e){var t=this.contextGL,r=this.texturePosBuffer,n=this.textureRef,i=e.data,a=this.width,o=this.height,s=e.dataPerRow||2*a,u=e.rowCnt||o;t.viewport(0,0,a,o);var l=o/u,h=a/(s/2),f=new Float32Array([h,0,0,0,h,l,0,l]);t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,f,t.DYNAMIC_DRAW),t.uniform2f(t.getUniformLocation(this.shaderProgram,"resolution"),s,o),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,s,u,0,t.LUMINANCE,t.UNSIGNED_BYTE,i),t.drawArrays(t.TRIANGLE_STRIP,0,4)})}return i(e,[{key:"isWebGL",value:function(){return this.contextGL}},{key:"initContextGL",value:function(){for(var e=this.canvasElement,t=null,r=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=0;!t&&n<r.length;){var i=r[n];try{t=this.contextOptions?e.getContext(i,this.contextOptions):e.getContext(i)}catch(e){t=null}t&&"function"==typeof t.getParameter||(t=null),++n}this.contextGL=t}},{key:"initProgram",value:function(){var e=this.contextGL,t=void 0,r=void 0;"yuv420"===this.type?(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","attribute vec4 uTexturePos;","attribute vec4 vTexturePos;","varying vec2 textureCoord;","varying vec2 uTextureCoord;","varying vec2 vTextureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","  uTextureCoord = uTexturePos.xy;","  vTextureCoord = vTexturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","varying highp vec2 uTextureCoord;","varying highp vec2 vTextureCoord;","uniform sampler2D ySampler;","uniform sampler2D uSampler;","uniform sampler2D vSampler;","uniform mat4 YUV2RGB;","void main(void) {","  highp float y = texture2D(ySampler,  textureCoord).r;","  highp float u = texture2D(uSampler,  uTextureCoord).r;","  highp float v = texture2D(vSampler,  vTextureCoord).r;","  gl_FragColor = vec4(y, u, v, 1) * YUV2RGB;","}"].join("\n")):"yuv422"===this.type&&(t=["attribute vec4 vertexPos;","attribute vec4 texturePos;","varying vec2 textureCoord;","void main()","{","  gl_Position = vertexPos;","  textureCoord = texturePos.xy;","}"].join("\n"),r=["precision highp float;","varying highp vec2 textureCoord;","uniform sampler2D sampler;","uniform highp vec2 resolution;","uniform mat4 YUV2RGB;","void main(void) {","  highp float texPixX = 1.0 / resolution.x;","  highp float logPixX = 2.0 / resolution.x;","  highp float logHalfPixX = 4.0 / resolution.x;","  highp float steps = floor(textureCoord.x / logPixX);","  highp float uvSteps = floor(textureCoord.x / logHalfPixX);","  highp float y = texture2D(sampler, vec2((logPixX * steps) + texPixX, textureCoord.y)).r;","  highp float u = texture2D(sampler, vec2((logHalfPixX * uvSteps), textureCoord.y)).r;","  highp float v = texture2D(sampler, vec2((logHalfPixX * uvSteps) + texPixX + texPixX, textureCoord.y)).r;","  gl_FragColor = vec4(y, u, v, 1.0) * YUV2RGB;","}"].join("\n"));var n=[];n="rec709"==this.conversionType?[1.16438,0,1.79274,-.97295,1.16438,-.21325,-.53291,.30148,1.16438,2.1124,0,-1.1334,0,0,0,1]:[1.16438,0,1.59603,-.87079,1.16438,-.39176,-.81297,.52959,1.16438,2.01723,0,-1.08139,0,0,0,1];var i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)||console.log("Vertex shader failed to compile: "+e.getShaderInfoLog(i));var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,r),e.compileShader(a),e.getShaderParameter(a,e.COMPILE_STATUS)||console.log("Fragment shader failed to compile: "+e.getShaderInfoLog(a));var o=e.createProgram();e.attachShader(o,i),e.attachShader(o,a),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||console.log("Program failed to compile: "+e.getProgramInfoLog(o)),e.useProgram(o);var s=e.getUniformLocation(o,"YUV2RGB");e.uniformMatrix4fv(s,!1,n),this.shaderProgram=o}},{key:"initBuffers",value:function(){var e=this.contextGL,t=this.shaderProgram,r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,-1,1,1,-1,-1,-1]),e.STATIC_DRAW);var n=e.getAttribLocation(t,"vertexPos");if(e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.animationTime){var i=this.animationTime,a=0;!function r(){a+=15;var n=1*a/i;a>=i?n=1:setTimeout(r,15);var o=-1*n,s=1*n,u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([s,s,o,s,s,o,o,o]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"vertexPos");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0);try{e.drawArrays(e.TRIANGLE_STRIP,0,4)}catch(e){console.log()}}()}var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var s=e.getAttribLocation(t,"texturePos");if(e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),this.texturePosBuffer=o,"yuv420"===this.type){var u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var l=e.getAttribLocation(t,"uTexturePos");e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0),this.uTexturePosBuffer=u;var h=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,h),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW);var f=e.getAttribLocation(t,"vTexturePos");e.enableVertexAttribArray(f),e.vertexAttribPointer(f,2,e.FLOAT,!1,0,0),this.vTexturePosBuffer=h}}},{key:"initTextures",value:function(){var e=this.contextGL,t=this.shaderProgram;if("yuv420"===this.type){var r=this.initTexture(),n=e.getUniformLocation(t,"ySampler");e.uniform1i(n,0),this.yTextureRef=r;var i=this.initTexture(),a=e.getUniformLocation(t,"uSampler");e.uniform1i(a,1),this.uTextureRef=i;var o=this.initTexture(),s=e.getUniformLocation(t,"vSampler");e.uniform1i(s,2),this.vTextureRef=o}else if("yuv422"===this.type){var u=this.initTexture(),l=e.getUniformLocation(t,"sampler");e.uniform1i(l,0),this.textureRef=u}}},{key:"initTexture",value:function(){var e=this.contextGL,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},{key:"drawNextOutputPicture",value:function(e,t,r,n){this.contextGL?this.drawNextOuptutPictureGL(e,t,r,n):this.drawNextOuptutPictureRGBA(e,t,r,n)}},{key:"drawNextOuptutPictureRGBA",value:function(e,t,r,n){var i=this.canvasElement;r=null;var a=n,o=i.getContext("2d"),s=o.getImageData(0,0,e,t);s.data.set(a),null===r?o.putImageData(s,0,0):o.putImageData(s,-r.left,-r.top,0,0,r.width,r.height)}}]),e}();r.default=a},{}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},a={};if(i.browser){a[i.browser]=!0;var o=i.majorVersion.split(".");a.version={major:parseInt(i.majorVersion,10),string:i.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}i.platform&&(a[i.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),(a.rv||a.iemobile)&&(a.rv&&delete a.rv,i.browser="msie",a.msie=!0),a.edge&&(delete a.edge,i.browser="msedge",a.msedge=!0),a.opr&&(i.browser="opera",a.opera=!0),a.safari&&a.android&&(i.browser="android",a.android=!0),a.name=i.browser,a.platform=i.platform;for(var s in n)n.hasOwnProperty(s)&&delete n[s];Object.assign(n,a)}(),r.default=n},{}],20:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r.RuntimeException=function(){function e(t){a(this,e),this._message=t}return o(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}();r.IllegalStateException=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),o(t,[{key:"name",get:function(){return"IllegalStateException"}}]),t}(s),r.InvalidArgumentException=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),o(t,[{key:"name",get:function(){return"InvalidArgumentException"}}]),t}(s),r.NotImplementedException=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return i(t,e),o(t,[{key:"name",get:function(){return"NotImplementedException"}}]),t}(s)},{}],21:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("events"),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return i(e,null,[{key:"e",value:function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",n),e.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))}},{key:"i",value:function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",n),e.ENABLE_INFO&&(console.info?console.info(n):console.log(n))}},{key:"w",value:function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",n),e.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))}},{key:"d",value:function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",n),e.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))}},{key:"v",value:function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var n="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",n),e.ENABLE_VERBOSE&&console.log(n)}}]),e}();s.GLOBAL_TAG="flv.js",s.FORCE_GLOBAL_TAG=!1,s.ENABLE_ERROR=!0,s.ENABLE_INFO=!0,s.ENABLE_WARN=!0,s.ENABLE_DEBUG=!0,s.ENABLE_VERBOSE=!0,s.ENABLE_CALLBACK=!1,s.emitter=new o.default,r.default=s},{events:2}],22:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(){function t(){n(this,t)}return i(t,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(void 0!==n&&null!==n)for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}return t},"function"!=typeof self.Promise&&e("es6-promise").polyfill()}}]),t}();a.install(),r.default=a},{"es6-promise":1}],23:[function(e,t,r){"use strict";function n(e,t,r){var n=e;if(t+r<n.length){for(;r--;)if(128!=(192&n[++t]))return!1;return!0}return!1}function i(e){for(var t=[],r=e,i=0,a=e.length;i<a;)if(r[i]<128)t.push(String.fromCharCode(r[i])),++i;else{if(r[i]<192);else if(r[i]<224){if(n(r,i,1)){var o=(31&r[i])<<6|63&r[i+1];if(o>=128){t.push(String.fromCharCode(65535&o)),i+=2;continue}}}else if(r[i]<240){if(n(r,i,2)){var s=(15&r[i])<<12|(63&r[i+1])<<6|63&r[i+2];if(s>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),i+=3;continue}}}else if(r[i]<248&&n(r,i,3)){var u=(7&r[i])<<18|(63&r[i+1])<<12|(63&r[i+2])<<6|63&r[i+3];if(u>65536&&u<1114112){u-=65536,t.push(String.fromCharCode(u>>>10|55296)),t.push(String.fromCharCode(1023&u|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")}Object.defineProperty(r,"__esModule",{value:!0}),r.default=i},{}]},{},[12])(12)});
//# sourceMappingURL=flv2canvas.min.js.map
